<div class="container py-5">
  <h1 class="text-center text-warning mb-5 display-4">Ajouter un film</h1>

  @if (!auth.isModeratorOrAdmin()) {
    <div class="text-center py-5">
      <h2 class="text-danger">Accès refusé</h2>
      <p>Seuls les modérateurs et administrateurs peuvent ajouter des films.</p>
    </div>
  } @else {

    <div class="card max-w-4xl mx-auto p-5">
      <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="grid-2">
          <div class="mb-4">
            <label>ID TMDB *</label>
            <input type="text" formControlName="tmdbId" placeholder="Ex: 27205 (Inception)" class="input-field"/>
            <button type="button" (click)="fetchFromTmdb()" [disabled]="loading || form.get('tmdbId')?.invalid"
                    class="btn btn-outline mt-2">
              @if (loading) {
                Chargement...
              } @else {
                Récupérer depuis TMDB
              }
            </button>
          </div>
        </div>

        <div class="grid-2">
          <div class="mb-4">
            <label>Titre *</label>
            <input formControlName="title" class="input-field"/>
          </div>
          <div class="mb-4">
            <label>Titre original</label>
            <input formControlName="originalTitle" class="input-field"/>
          </div>
        </div>

        <div class="mb-4">
          <label>Synopsis</label>
          <textarea formControlName="overview" rows="4" class="input-field"></textarea>
        </div>

        <div class="grid-3">
          <div class="mb-4">
            <label>Date de sortie</label>
            <input type="date" formControlName="releaseDate" class="input-field"/>
          </div>
          <div class="mb-4">
            <label>Durée (min)</label>
            <input type="number" formControlName="runtime" class="input-field"/>
          </div>
          <div class="mb-4">
            <label>Note /10</label>
            <input type="number" step="0.1" formControlName="voteAverage" class="input-field"/>
          </div>
        </div>

        <div class="grid-2">
          <div class="mb-4">
            <label>Affiche (poster_path)</label>
            <input formControlName="posterPath" class="input-field" placeholder="/abc123.jpg"/>
          </div>
          <div class="mb-4">
            <label>Arrière-plan</label>
            <input formControlName="backdropPath" class="input-field"/>
          </div>
        </div>

        <div class="mb-4">
          <label>Réalisateur</label>
          <input formControlName="director" class="input-field"/>
        </div>

        <div class="mb-5">
          <label>Lien trailer YouTube</label>
          <input formControlName="trailerUrl" class="input-field" placeholder="dQw4w9WgXcQ"/>
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-primary large" [disabled]="form.invalid">
            Ajouter le film
          </button>

          @if (success) {
            <div class="success-msg mt-4">Film ajouté avec succès !</div>
          }
        </div>
      </form>
    </div>
  }
</div>
